<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Atelier de Révision : Le Pronom (Niveau Avancé)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Patrick+Hand&family=Roboto:wght@400;500;700&display=swap');


        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f3f4f6;
        }


        .handwritten {
            font-family: 'Patrick Hand', cursive;
        }


        .word-span {
            cursor: pointer;
            padding: 2px 4px;
            border-radius: 4px;
            transition: all 0.2s;
            position: relative;
            display: inline-block;
            margin: 0 1px;
        }


        .word-span:hover {
            background-color: #e5e7eb;
            transform: scale(1.05);
        }


        /* Tooltip (Phylactère) Styles */
        .tooltip {
            position: absolute;
            bottom: 120%; /* Position above word */
            left: 50%;
            transform: translateX(-50%);
            padding: 8px 12px;
            border-radius: 8px;
            color: white;
            font-size: 0.9rem;
            white-space: nowrap;
            z-index: 50;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            opacity: 0;
            transition: opacity 0.2s;
            pointer-events: none;
            font-weight: bold;
        }


        .tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -6px;
            border-width: 6px;
            border-style: solid;
        }


        .tooltip.show {
            opacity: 1;
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }


        .tooltip.is-pronoun {
            background-color: #10b981; /* Green-500 */
        }
        .tooltip.is-pronoun::after {
            border-color: #10b981 transparent transparent transparent;
        }


        .tooltip.not-pronoun {
            background-color: #ef4444; /* Red-500 */
        }
        .tooltip.not-pronoun::after {
            border-color: #ef4444 transparent transparent transparent;
        }


        /* Antecedent Exercise Styles */
        .antecedent-word {
            cursor: pointer;
            border-bottom: 2px dashed #9ca3af;
        }
        .antecedent-word:hover {
            background-color: #dbeafe;
        }
        .antecedent-word.correct {
            background-color: #86efac;
            border-color: #166534;
            color: #14532d;
        }
        .antecedent-word.wrong {
            background-color: #fca5a5;
            text-decoration: line-through;
        }


        @keyframes popIn {
            0% { transform: translateX(-50%) scale(0.5); opacity: 0; }
            100% { transform: translateX(-50%) scale(1); opacity: 1; }
        }


        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }


        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4">


    <!-- Container -->
    <div class="bg-white w-full max-w-5xl rounded-2xl shadow-xl overflow-hidden min-h-[600px] flex flex-col relative">
        
        <!-- Header -->
        <header class="bg-indigo-600 text-white p-6 flex justify-between items-center shadow-md z-10">
            <div class="flex items-center gap-4">
                <div class="bg-white text-indigo-600 p-2 rounded-full w-12 h-12 flex items-center justify-center font-bold text-xl shadow-inner">
                    <i class="fas fa-graduation-cap"></i>
                </div>
                <div>
                    <h1 class="text-2xl font-bold handwritten tracking-wide">La Grammaire Interactive</h1>
                    <p class="text-indigo-200 text-sm">Niveau : Secondaire 1 • Module : Le Pronom (Avancé)</p>
                </div>
            </div>
            <div class="hidden md:block">
                <div class="bg-indigo-700 px-4 py-2 rounded-lg text-sm font-semibold" id="progress-indicator">
                    Étape <span id="current-step">1</span>/3
                </div>
            </div>
        </header>


        <!-- Content Area -->
        <main id="app-content" class="flex-grow p-8 flex flex-col justify-center items-center relative">
            <!-- Dynamic Content will be injected here via JS -->
        </main>


        <!-- Footer / Controls -->
        <footer class="bg-gray-50 p-6 border-t border-gray-100 flex justify-between items-center">
            <button id="btn-prev" class="px-6 py-2 rounded-lg text-gray-500 hover:bg-gray-200 transition disabled:opacity-30 disabled:cursor-not-allowed hidden">
                <i class="fas fa-arrow-left mr-2"></i> Précédent
            </button>
            
            <div class="flex gap-2" id="dots-container">
                <!-- Dots generated by JS -->
            </div>


            <button id="btn-next" class="bg-indigo-600 hover:bg-indigo-700 text-white px-8 py-2 rounded-lg shadow-lg transform transition active:scale-95 flex items-center">
                Suivant <i class="fas fa-arrow-right ml-2"></i>
            </button>
        </footer>
    </div>


    <!-- JavaScript Application Logic -->
    <script>
        // --- DATA ---


        const appState = {
            currentSlide: 0,
            score: 0
        };


        const slides = [
            // Slide 0: Intro
            {
                type: 'intro',
                title: "Défi Expert : Le Pronom",
                content: `
                    <div class="text-center space-y-6 max-w-lg mx-auto">
                        <div class="text-6xl text-indigo-500 mb-4 animate-bounce">
                            <i class="fas fa-brain"></i>
                        </div>
                        <p class="text-lg text-gray-700">
                            Attention ! Cette version est plus corsée. Nous allons travailler les cas de confusion fréquents.
                        </p>
                        <div class="bg-red-50 p-4 rounded-lg border-l-4 border-red-500 text-left">
                            <h3 class="font-bold text-red-700 mb-2">Les pièges à éviter :</h3>
                            <ul class="list-disc pl-5 space-y-2 text-gray-700 text-sm">
                                <li><strong>Le/La/Les :</strong> Sont-ils devant un nom (déterminants) ou un verbe (pronoms) ?</li>
                                <li><strong>Leur :</strong> Signifie-t-il "à eux" (pronom) ou "le sien/la sienne" (déterminant) ?</li>
                                <li><strong>Pronoms relatifs :</strong> Ne rate pas les <em>qui, que, dont, où</em> !</li>
                            </ul>
                        </div>
                         <p class="text-gray-600 italic mt-4">Prends ton temps, les phrases sont longues !</p>
                    </div>
                `
            },
            // Slide 1: Identification - Confusion LE/LA/LES
            {
                type: 'identification',
                sentence: [
                    {text: "Les", class: "Déterminant"},
                    {text: "spectateurs", class: "Nom"},
                    {text: "observent", class: "Verbe"},
                    {text: "les", class: "Déterminant"},
                    {text: "acrobates", class: "Nom"},
                    {text: "et", class: "Conjonction"},
                    {text: "les", class: "Pronom", type: "Pronom personnel (CD)"},
                    {text: "applaudissent", class: "Verbe"},
                    {text: "dès", class: "Préposition"},
                    {text: "qu'", class: "Conjonction"},
                    {text: "ils", class: "Pronom", type: "Pronom personnel"},
                    {text: "terminent", class: "Verbe"},
                    {text: "leur", class: "Déterminant"},
                    {text: "numéro", class: "Nom"},
                    {text: ".", class: "Ponctuation"}
                ]
            },
            // Slide 2: Identification - Confusion LEUR & Relative
            {
                type: 'identification',
                sentence: [
                    {text: "Si", class: "Conjonction"},
                    {text: "tu", class: "Pronom", type: "Pronom personnel"},
                    {text: "vois", class: "Verbe"},
                    {text: "tes", class: "Déterminant"},
                    {text: "voisins", class: "Nom"},
                    {text: ",", class: "Ponctuation"},
                    {text: "donne", class: "Verbe"},
                    {text: "-", class: "Tiret"},
                    {text: "leur", class: "Pronom", type: "Pronom personnel (CI)"},
                    {text: "le", class: "Déterminant"},
                    {text: "courrier", class: "Nom"},
                    {text: "qui", class: "Pronom", type: "Pronom relatif"},
                    {text: "traîne", class: "Verbe"},
                    {text: "sur", class: "Préposition"},
                    {text: "leur", class: "Déterminant"},
                    {text: "galerie", class: "Nom"},
                    {text: ".", class: "Ponctuation"}
                ]
            },
             // Slide 3: Identification - Demonstrative & Indefinite
             {
                type: 'identification',
                sentence: [
                    {text: "Certains", class: "Pronom", type: "Pronom indéfini"},
                    {text: "préfèrent", class: "Verbe"},
                    {text: "ce", class: "Déterminant"},
                    {text: "modèle", class: "Nom"},
                    {text: ",", class: "Ponctuation"},
                    {text: "mais", class: "Conjonction"},
                    {text: "moi", class: "Pronom", type: "Pronom tonique"},
                    {text: ",", class: "Ponctuation"},
                    {text: "je", class: "Pronom", type: "Pronom personnel"},
                    {text: "choisirais", class: "Verbe"},
                    {text: "celui", class: "Pronom", type: "Pronom démonstratif"},
                    {text: "dont", class: "Pronom", type: "Pronom relatif"},
                    {text: "nous", class: "Pronom", type: "Pronom personnel"},
                    {text: "avons", class: "Verbe"},
                    {text: "parlé", class: "Verbe"},
                    {text: "hier", class: "Adverbe"},
                    {text: ".", class: "Ponctuation"}
                ]
            },
            // Slide 4: Identification - "Le" neutre & "En"
            {
                type: 'identification',
                sentence: [
                    {text: "Elle", class: "Pronom", type: "Pronom personnel"},
                    {text: "voulait", class: "Verbe"},
                    {text: "du", class: "Déterminant"},
                    {text: "chocolat", class: "Nom"},
                    {text: ",", class: "Ponctuation"},
                    {text: "alors", class: "Conjonction"},
                    {text: "j'", class: "Pronom", type: "Pronom personnel"},
                    {text: "en", class: "Pronom", type: "Pronom personnel/adverbial"},
                    {text: "ai", class: "Verbe"},
                    {text: "acheté", class: "Verbe"},
                    {text: ",", class: "Ponctuation"},
                    {text: "même", class: "Adverbe"},
                    {text: "si", class: "Conjonction"},
                    {text: "je", class: "Pronom", type: "Pronom personnel"},
                    {text: "le", class: "Pronom", type: "Pronom personnel (Neutre)"},
                    {text: "savais", class: "Verbe"},
                    {text: "déjà", class: "Adverbe"},
                    {text: "interdit", class: "Adjectif"},
                    {text: ".", class: "Ponctuation"}
                ]
            },
            // Slide 5: Antecedent Intro
            {
                type: 'info',
                title: "Détective d'Antécédents",
                content: `
                    <div class="text-center max-w-xl mx-auto">
                        <div class="text-6xl text-blue-500 mb-6">
                            <i class="fas fa-search-plus"></i>
                        </div>
                        <h3 class="text-2xl font-bold text-gray-800 mb-4">Attention aux pièges !</h3>
                        <p class="text-lg text-gray-600 mb-6">
                            Ici, plusieurs noms pourraient être l'antécédent. Tu dois utiliser la logique et l'accord (genre/nombre) pour trouver la bonne réponse.
                        </p>
                        <p class="mt-6 font-semibold text-indigo-600 bg-blue-50 p-3 rounded">
                            Exemple : "La <strong>fille</strong> de mes voisins est gentille. <strong>Elle</strong>..." <br>
                            (C'est la fille, pas les voisins !)
                        </p>
                    </div>
                `
            },
            // Slide 6: Antecedent Complex 1
            {
                type: 'antecedent',
                context: "Les conseillers ont présenté les résultats financiers aux actionnaires.",
                targetSentence: "Malheureusement, <strong>ceux-ci</strong> n'ont pas été satisfaits.",
                words: [
                    {text: "Les", correct: false},
                    {text: "conseillers", correct: false, feedback: "Non. Ce sont les actionnaires qui doivent être satisfaits (ou non)."},
                    {text: "ont", correct: false},
                    {text: "présenté", correct: false},
                    {text: "les", correct: false},
                    {text: "résultats", correct: false, feedback: "Grammaticalement possible, mais le sens veut que ce soient des personnes qui soient satisfaites."},
                    {text: "financiers", correct: false},
                    {text: "aux", correct: false},
                    {text: "actionnaires", correct: true, feedback: "Exact ! 'Ceux-ci' reprend le groupe nominal le plus proche ou logique : les gens insatisfaits."}
                ],
                pronoun: "ceux-ci"
            },
            // Slide 7: Antecedent Complex 2
            {
                type: 'antecedent',
                context: "J'ai rangé ma vieille guitare dans une boîte en carton.",
                targetSentence: "Je vais <strong>la</strong> jeter demain matin.",
                words: [
                    {text: "J'", correct: false},
                    {text: "ai", correct: false},
                    {text: "rangé", correct: false},
                    {text: "ma", correct: false},
                    {text: "vieille", correct: false},
                    {text: "guitare", correct: false, feedback: "Piège ! On ne jette probablement pas la guitare, mais l'emballage... Relis bien la phrase."},
                    {text: "dans", correct: false},
                    {text: "une", correct: false},
                    {text: "boîte", correct: true, feedback: "Bravo pour ta logique ! On jette la boîte, pas la guitare."},
                    {text: "en", correct: false},
                    {text: "carton", correct: false}
                ],
                pronoun: "la"
            },
             // Slide 8: Antecedent Complex 3
             {
                type: 'antecedent',
                context: "Le courage des pompiers a impressionné toute la foule.",
                targetSentence: "<strong>Il</strong> restera gravé dans les mémoires.",
                words: [
                    {text: "Le", correct: false},
                    {text: "courage", correct: true, feedback: "Oui ! C'est le courage qui reste gravé."},
                    {text: "des", correct: false},
                    {text: "pompiers", correct: false, feedback: "'Pompiers' est au pluriel, mais 'Il' est singulier !"},
                    {text: "a", correct: false},
                    {text: "impressionné", correct: false},
                    {text: "toute", correct: false},
                    {text: "la", correct: false},
                    {text: "foule", correct: false, feedback: "'Foule' est féminin, 'Il' est masculin."}
                ],
                pronoun: "Il"
            },
            // Slide 9: Substitution Intro
            {
                type: 'info',
                title: "Constructeur Expert",
                content: `
                    <div class="text-center max-w-xl mx-auto">
                         <div class="text-6xl text-purple-500 mb-6">
                            <i class="fas fa-cogs"></i>
                        </div>
                        <h3 class="text-2xl font-bold text-gray-800 mb-4">Remplacements complexes</h3>
                        <p class="text-lg text-gray-600 mb-6">
                            On s'attaque maintenant aux compléments indirects (à qui ?) et aux lieux. Fais attention à la structure du verbe !
                        </p>
                    </div>
                `
            },
            // Slide 10: Sub Ex 1 (LUI vs LE)
            {
                type: 'substitution',
                sentence1: "L'architecte envoie les plans <strong>au client</strong>.",
                sentence2Part1: "L'architecte ",
                sentence2Part2: " envoie les plans.",
                options: ["le", "lui", "y", "l'"],
                correct: "lui",
                feedback: "Correct ! On envoie À quelqu'un (complément indirect) -> lui."
            },
            // Slide 11: Sub Ex 2 (Y vs LE)
            {
                type: 'substitution',
                sentence1: "Tu dois réfléchir <strong>à ce problème</strong> sérieusement.",
                sentence2Part1: "Tu dois ",
                sentence2Part2: " réfléchir sérieusement.",
                options: ["le", "lui", "y", "en"],
                correct: "y",
                feedback: "Exact ! Réfléchir 'à' quelque chose (inanimé) -> y."
            },
            // Slide 12: Sub Ex 3 (EN vs LE)
            {
                type: 'substitution',
                sentence1: "Les enfants mangent <strong>des bonbons</strong>.",
                sentence2Part1: "Les enfants ",
                sentence2Part2: " mangent.",
                options: ["les", "en", "ils", "le"],
                correct: "en",
                feedback: "Bien joué ! Quand le nom est introduit par 'un', 'une', 'des' ou 'de', on utilise souvent 'en'."
            },
            // Slide 13: Sub Ex 4 (Double pronom implicite)
            {
                type: 'substitution',
                sentence1: "Ne prête pas ta voiture <strong>à tes amis</strong>.",
                sentence2Part1: "Ne ",
                sentence2Part2: " prête pas ta voiture.",
                options: ["les", "leur", "y", "eux"],
                correct: "leur",
                feedback: "Oui ! Prêter à plusieurs personnes (à qui ?) -> leur."
            },
            // Slide 14: Conclusion
            {
                type: 'intro',
                title: "Défi complété !",
                content: `
                    <div class="text-center space-y-6">
                        <div class="text-yellow-400 text-6xl animate-pulse">
                            <i class="fas fa-trophy"></i>
                        </div>
                        <h2 class="text-3xl font-bold text-gray-800">Niveau Expert atteint !</h2>
                        <p class="text-gray-600 max-w-md mx-auto">
                            Ces exercices étaient beaucoup plus difficiles. Si tu as réussi à distinguer les "les" déterminants des "les" pronoms, tu es prêt pour n'importe quel test !
                        </p>
                        <div class="mt-8">
                            <button onclick="location.reload()" class="bg-indigo-100 text-indigo-700 px-6 py-3 rounded-lg font-bold hover:bg-indigo-200 transition">
                                <i class="fas fa-redo mr-2"></i> Recommencer
                            </button>
                        </div>
                    </div>
                `
            }
        ];


        // --- DOM ELEMENTS ---
        const mainContent = document.getElementById('app-content');
        const btnNext = document.getElementById('btn-next');
        const btnPrev = document.getElementById('btn-prev');
        const dotsContainer = document.getElementById('dots-container');
        const progressIndicator = document.getElementById('current-step');


        // --- RENDER FUNCTIONS ---


        function renderSlide() {
            const slide = slides[appState.currentSlide];
            
            // Update UI State
            updateDots();
            progressIndicator.innerText = appState.currentSlide + 1;
            
            // Clear content with fade effect
            mainContent.innerHTML = '';
            const container = document.createElement('div');
            container.className = 'w-full fade-in';
            
            // Logic based on slide type
            if (slide.type === 'intro' || slide.type === 'info') {
                renderInfoSlide(slide, container);
            } else if (slide.type === 'identification') {
                renderIdentificationSlide(slide, container);
            } else if (slide.type === 'antecedent') {
                renderAntecedentSlide(slide, container);
            } else if (slide.type === 'substitution') {
                renderSubstitutionSlide(slide, container);
            }


            mainContent.appendChild(container);


            // Button Logic
            btnPrev.style.display = appState.currentSlide === 0 ? 'none' : 'block';
            if (appState.currentSlide === slides.length - 1) {
                btnNext.style.display = 'none';
            } else {
                btnNext.style.display = 'flex';
            }
        }


        function renderInfoSlide(slide, container) {
            container.innerHTML = `
                <h2 class="text-3xl font-bold text-gray-800 text-center mb-8 handwritten">${slide.title || ''}</h2>
                ${slide.content}
            `;
        }


        function renderIdentificationSlide(slide, container) {
            const wrapper = document.createElement('div');
            wrapper.className = "flex flex-col items-center justify-center space-y-8 mt-4";


            const instruction = document.createElement('p');
            instruction.className = "text-gray-500 italic mb-4";
            instruction.innerHTML = "<i class='fas fa-mouse-pointer mr-2'></i>Clique sur chaque mot. Trouve TOUS les pronoms.";
            wrapper.appendChild(instruction);


            const sentenceDiv = document.createElement('div');
            // Changed layout for longer sentences: text-left on mobile, center on desktop
            sentenceDiv.className = "text-xl md:text-2xl leading-loose font-medium text-gray-800 bg-white p-6 md:p-8 rounded-xl border border-gray-200 shadow-sm text-left md:text-center";


            slide.sentence.forEach((wordObj, index) => {
                const span = document.createElement('span');
                span.textContent = wordObj.text;
                span.className = "word-span relative";
                
                // Interaction Logic
                span.onclick = (e) => {
                    // Remove existing tooltips
                    document.querySelectorAll('.tooltip').forEach(t => t.remove());


                    const tooltip = document.createElement('div');
                    const isPronoun = wordObj.class === "Pronom";
                    
                    tooltip.className = `tooltip ${isPronoun ? 'is-pronoun' : 'not-pronoun'}`;
                    
                    if (isPronoun) {
                        tooltip.innerHTML = `<i class="fas fa-check-circle mr-1"></i> <strong>${wordObj.class}</strong><br><span class="text-xs opacity-90">${wordObj.type}</span>`;
                    } else {
                        tooltip.innerHTML = `<i class="fas fa-times-circle mr-1"></i> ${wordObj.class}`;
                    }


                    span.appendChild(tooltip);
                    
                    // Force reflow
                    void tooltip.offsetWidth;
                    tooltip.classList.add('show');
                };


                sentenceDiv.appendChild(span);
                
                // Smart spacing: don't add space if next char is punctuation (roughly)
                // Simplified logic: add space unless current is apostrophe start (l', j') 
                // BUT my data structure splits "l'" and "acrobates". 
                // If the word ends in apostrophe, no space.
                if (index < slide.sentence.length - 1) {
                    const currentTxt = wordObj.text;
                    const nextTxt = slide.sentence[index+1].text;
                    
                    // Don't add space if current word ends in '
                    if (!currentTxt.endsWith("'") && !['.', ',', ')'].includes(nextTxt)) {
                        sentenceDiv.appendChild(document.createTextNode(" "));
                    }
                }
            });


            wrapper.appendChild(sentenceDiv);
            container.appendChild(wrapper);
        }


        function renderAntecedentSlide(slide, container) {
            const wrapper = document.createElement('div');
            wrapper.className = "max-w-3xl mx-auto mt-6 space-y-6";


            const instruction = document.createElement('div');
            instruction.className = "bg-blue-50 text-blue-800 p-4 rounded-lg flex items-start gap-3 text-sm md:text-base";
            instruction.innerHTML = `
                <i class="fas fa-info-circle mt-1"></i>
                <p>Lis attentivement. Le pronom <strong>${slide.pronoun}</strong> remplace quoi ? (Utilise ta logique !)</p>
            `;
            wrapper.appendChild(instruction);


            // Sentence Container
            const sentenceBox = document.createElement('div');
            sentenceBox.className = "bg-white p-6 md:p-8 rounded-xl shadow-md border border-gray-200 text-lg md:text-xl";


            // Sentence 1 (Clickable)
            const sent1Div = document.createElement('div');
            sent1Div.className = "mb-4 leading-loose";
            
            slide.words.forEach((w, idx) => {
                const span = document.createElement('span');
                span.textContent = w.text;
                span.className = "word-span antecedent-word rounded px-1 mx-1";
                
                span.onclick = function() {
                    // Reset others
                    sent1Div.querySelectorAll('.antecedent-word').forEach(el => {
                        el.classList.remove('correct', 'wrong');
                    });
                    
                    // Remove existing feedback box
                    const existingFeedback = document.getElementById('feedback-box');
                    if(existingFeedback) existingFeedback.remove();


                    // Create Feedback
                    const feedbackBox = document.createElement('div');
                    feedbackBox.id = "feedback-box";
                    feedbackBox.className = "mt-4 p-4 rounded-lg text-base font-bold flex items-center gap-3 animate-bounce-in";


                    if (w.correct) {
                        span.classList.add('correct');
                        feedbackBox.classList.add('bg-green-100', 'text-green-800', 'border', 'border-green-200');
                        feedbackBox.innerHTML = `<i class="fas fa-check-circle text-2xl"></i> <div>${w.feedback}</div>`;
                    } else {
                        span.classList.add('wrong');
                        feedbackBox.classList.add('bg-red-100', 'text-red-800', 'border', 'border-red-200');
                        feedbackBox.innerHTML = `<i class="fas fa-times-circle text-2xl"></i> <div>${w.feedback || "Essaie encore ! Regarde le genre et le nombre."}</div>`;
                    }
                    
                    sentenceBox.appendChild(feedbackBox);
                };
                
                sent1Div.appendChild(span);
                sent1Div.appendChild(document.createTextNode(" "));
            });


            // Sentence 2 (Static with bold)
            const sent2Div = document.createElement('div');
            sent2Div.className = "text-gray-600 mt-2 border-t pt-4";
            sent2Div.innerHTML = slide.targetSentence;


            sentenceBox.appendChild(sent1Div);
            sentenceBox.appendChild(sent2Div);
            wrapper.appendChild(sentenceBox);
            container.appendChild(wrapper);
        }


        function renderSubstitutionSlide(slide, container) {
            const wrapper = document.createElement('div');
            wrapper.className = "max-w-2xl mx-auto mt-8 space-y-6";


            const instruction = document.createElement('h3');
            instruction.className = "text-xl font-bold text-center text-gray-700";
            instruction.textContent = "Remplace ce qui est en gras :";
            wrapper.appendChild(instruction);


            const card = document.createElement('div');
            card.className = "bg-white p-8 rounded-xl shadow-lg border border-gray-200";


            // Original Sentence
            const original = document.createElement('p');
            original.className = "text-xl mb-6 text-gray-500 border-b pb-4";
            original.innerHTML = `Phrase : ${slide.sentence1}`;
            card.appendChild(original);


            // Interaction Sentence
            const interactionLine = document.createElement('div');
            interactionLine.className = "text-2xl text-gray-800 flex flex-wrap items-center gap-2";
            
            const part1 = document.createElement('span');
            part1.textContent = slide.sentence2Part1;
            
            const select = document.createElement('select');
            select.className = "bg-indigo-50 border-2 border-indigo-200 rounded px-3 py-1 text-indigo-700 font-bold focus:outline-none focus:border-indigo-500 cursor-pointer text-xl";
            
            // Default option
            const defOpt = document.createElement('option');
            defOpt.text = "?";
            defOpt.value = "";
            select.add(defOpt);


            slide.options.forEach(opt => {
                const o = document.createElement('option');
                o.value = opt;
                o.text = opt;
                select.add(o);
            });


            const part2 = document.createElement('span');
            part2.textContent = slide.sentence2Part2;


            interactionLine.appendChild(part1);
            interactionLine.appendChild(select);
            interactionLine.appendChild(part2);
            card.appendChild(interactionLine);


            // Feedback Area
            const feedbackDiv = document.createElement('div');
            feedbackDiv.className = "mt-6 hidden";
            card.appendChild(feedbackDiv);


            select.addEventListener('change', (e) => {
                const val = e.target.value;
                if (!val) return;


                feedbackDiv.classList.remove('hidden');
                
                if (val === slide.correct) {
                    select.classList.remove('border-red-500', 'bg-red-50');
                    select.classList.add('border-green-500', 'bg-green-50');
                    feedbackDiv.className = "mt-6 p-4 rounded bg-green-100 text-green-800 flex items-center gap-3 animate-pulse";
                    feedbackDiv.innerHTML = `<i class="fas fa-check text-xl"></i> ${slide.feedback}`;
                } else {
                    select.classList.remove('border-green-500', 'bg-green-50');
                    select.classList.add('border-red-500', 'bg-red-50');
                    feedbackDiv.className = "mt-6 p-4 rounded bg-red-100 text-red-800 flex items-center gap-3";
                    feedbackDiv.innerHTML = `<i class="fas fa-times text-xl"></i> Ce n'est pas le bon choix.`;
                }
            });


            wrapper.appendChild(card);
            container.appendChild(wrapper);
        }


        function updateDots() {
            dotsContainer.innerHTML = '';
            slides.forEach((_, idx) => {
                const dot = document.createElement('div');
                dot.className = `w-2 h-2 rounded-full transition-all duration-300 ${idx === appState.currentSlide ? 'bg-indigo-600 w-4' : 'bg-gray-300'}`;
                dotsContainer.appendChild(dot);
            });
        }


        // --- EVENTS ---


        btnNext.addEventListener('click', () => {
            if (appState.currentSlide < slides.length - 1) {
                appState.currentSlide++;
                renderSlide();
            }
        });


        btnPrev.addEventListener('click', () => {
            if (appState.currentSlide > 0) {
                appState.currentSlide--;
                renderSlide();
            }
        });


        // --- INIT ---
        renderSlide();


    </script>
</body>
</html>